## This is a automake file, part of Unidata's netCDF package.
# Copyright 2005-2019, see the COPYRIGHT file for more information.

# These are the fortran 90 API tests.

# Ed Hartnett, Russ Rew, Dennis Heimbigner, Ward Fisher

# Parallel builds don't currently work in this directory.
.NOTPARALLEL:

AM_FCFLAGS = -I$(top_builddir)/fortran ${AM_CPPFLAGS}

# Some fortran compilers think your files should not have an .f90
# extension! The value of FCFLAGS_f90 is set in the configure script,
# based on the fortran compiler.
AM_FCFLAGS += $(FCFLAGS_f90) @MOD_FLAG@$(top_builddir)/fortran

# Need some stuff from ../nf_test
AM_FCFLAGS += -I$(top_srcdir)/nf_test

AM_FFLAGS = ${AM_FCFLAGS}

# All tests need to link to fortran and C libraries.
LDADD = ${top_builddir}/fortran/libnetcdff.la

# Need access to top_srcdir
AM_TESTS_ENVIRONMENT = HDF5_PLUGIN_PATH='@PLUGINDIR@' ; export HDF5_PLUGIN_PATH ;
TESTS_ENVIRONMENT=TOPSRCDIR=${abs_top_srcdir}

# The create_fills shell creates the file fills.nc, needed by later
# tests.
TESTS = create_fills.sh

# nf03_test is the main test program.
check_PROGRAMS = nf03_test
TESTS += nf03_test
nf03_test_SOURCES = module_tests.F90 f03lib_f_interfaces.f90		\
test03_get.F test03_put.F nf03_error.F nf03_test.F test03_read.F	\
test03_write.F util03.F f03lib.c

# programs that "use tests" from the tests.mod module depend on it
# being built first, needed for make -j
nf03_error.o nf03_test.o test03_get.o test03_put.o test03_read.o test03_write.o tst03_f77_v2.o util03.o: \
module_tests.o

# Did the user build the V2 F77 API? If so, run these tests.
if BUILD_V2
check_PROGRAMS += tst03_f77_v2
tst03_f77_v2_SOURCES = tst03_f77_v2.F
TESTS += tst03_f77_v2
endif # BUILD_V2

# If valgrind is present on this machine, this will enable
# check-valgrind target, which runs all tests with valgrind.
@VALGRIND_CHECK_RULES@

# test03_get.F and test03_put.f need to be distributed, so that the user
# need not have m4.
EXTRA_DIST = test03_get.F test03_put.F fills.cdl create_fills.sh	\
CMakeLists.txt

# Cleaning up files created during the process.
CLEANFILES = scratch.nc fills.nc tst_f77_v2.nc tests.mod test.nc	\
ftst_*.nc f03tst_open_mem.nc temp.tmp
